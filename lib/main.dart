import 'package:flutter/material.dart';import 'package:flutter_staggered_grid_view/flutter_staggered_grid_view.dart';import 'package:http/http.dart' as http;import 'package:randomphotos/details.dart';import 'package:webfeed/webfeed.dart';void main() => runApp(MyApp());class MyApp extends StatelessWidget {@override Widget build(BuildContext context) {return MaterialApp(title: '20 pics',theme: ThemeData(primarySwatch: Colors.blueGrey,),home: MyHomePage(title: '20 pics'),);}}class MyHomePage extends StatefulWidget {MyHomePage({Key key, this.title}) : super(key: key);final String title;@override _MyHomePageState createState() => _MyHomePageState();}class _MyHomePageState extends State<MyHomePage> {List<Item> _items = List();List<StaggeredTile> _staggeredTiles = List();List<_ItemTile> _tiles = List();@override void initState() {super.initState();_getItems();}void _getItems() {http.get('https://api.flickr.com/services/feeds/photos_public.gne?format=rss2&tagmode=any').then((res) {if (res.statusCode == 200) {RssFeed feed = RssFeed.parse(res.body);setState(() {_items = feed.items.map(Item.create).toList(growable: false);_tiles = new List();_staggeredTiles = new List();for (int i = 0; i < _items.length; i++) {var item = _items.elementAt(i);var ratio = item.imgW / item.imgH;_tiles.add(_ItemTile(_items, i));_staggeredTiles.add(StaggeredTile.extent(1, 240 / ratio));}});}});}@override Widget build(BuildContext context) {return Scaffold(appBar: AppBar(title: Text(widget.title),),body: StaggeredGridView.extent(padding: EdgeInsets.all(12.0),maxCrossAxisExtent: 180.0,staggeredTiles: _staggeredTiles,children: _tiles,addAutomaticKeepAlives: false,mainAxisSpacing: 4.0,crossAxisSpacing: 4.0,),floatingActionButton: FloatingActionButton(onPressed: _getItems,tooltip: 'Refresh',child: Icon(Icons.refresh),),);}}class _ItemTile extends StatelessWidget {_ItemTile(this.items, this.i) : item = items.elementAt(i);final int i;final List<Item> items;final Item item;@override Widget build(BuildContext context) {return new Card(shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8.0),),clipBehavior: Clip.antiAlias,elevation: 3.0,child: Ink.image(image: NetworkImage(item.imgUrl),fit: BoxFit.cover,child: new InkWell(onTap: () {DetailsPage.open(context, items, i);},),),);}}class Item {final double imgW, imgH;final String imgUrl;final String webUrl;final String title;final String author;Item({this.imgW,this.imgH,this.imgUrl,this.webUrl,this.title,this.author});static Item create(RssItem item) {var img = item.media.contents.first;return Item(imgW: img.width.toDouble(),imgH: img.height.toDouble(),imgUrl: img.url,webUrl: item.link,title: item.title,author: item.author);}}